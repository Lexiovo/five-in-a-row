<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½äº”å­æ£‹å¯¹æˆ˜ (å·²ä¿®å¤)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }
        
        .game-title {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .game-rules {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            text-align: center;
            max-width: 600px;
        }
        
        .game-canvas {
            margin: 0 auto;
            display: block;
        }
        
        .footer {
            font-size: 12px;
            color: #999;
            text-align: center;
            margin-top: 20px;
        }
        
        /* è°ƒè¯•ä¿¡æ¯æ ·å¼ */
        .debug-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-title">ğŸ® æ™ºèƒ½äº”å­æ£‹å¯¹æˆ˜</div>
        <div class="game-rules">
            é»‘æ£‹å…ˆè¡Œï¼Œç‚¹å‡»æ£‹ç›˜è½å­ã€‚AIä¼šè‡ªåŠ¨å›åº”ã€‚äº”å­è¿ç è·èƒœï¼<br>
            æ¸¸æˆç»“æŸåç‚¹å‡»é¼ æ ‡é‡æ–°å¼€å§‹ã€‚
        </div>
        <div id="canvas-container">
            <!-- p5.js will create the canvas here -->
        </div>
    </div>
    <div class="footer">
        Â© 2025 æ™ºèƒ½äº”å­æ£‹æ¸¸æˆ | ç‚¹å‡»æ£‹ç›˜å¼€å§‹å¯¹æˆ˜
    </div>

    <script>
        let board = []; // æ£‹ç›˜æ•°ç»„
        let currentPlayer = 1; // 1ä¸ºé»‘æ£‹ï¼ˆç©å®¶ï¼‰ï¼Œ2ä¸ºç™½æ£‹ï¼ˆAIï¼‰
        let gameOver = false;
        let winner = 0;
        let boardSize = 15; // 15x15æ£‹ç›˜
        let cellSize;
        let margin;
        let aiPlayer = 2; // AIç©å®¶å›ºå®šä¸ºç™½æ£‹
        let canvas;

        function setup() {
            // åˆ›å»ºç”»å¸ƒå¹¶æ·»åŠ åˆ°æŒ‡å®šå®¹å™¨
            canvas = createCanvas(600, 600);
            canvas.parent('canvas-container');
            canvas.addClass('game-canvas');
            
            cellSize = width / (boardSize + 1);
            margin = cellSize;
            
            // åˆå§‹åŒ–æ£‹ç›˜
            initializeBoard();
        }

        function initializeBoard() {
            board = [];
            for (let i = 0; i < boardSize; i++) {
                board[i] = [];
                for (let j = 0; j < boardSize; j++) {
                    board[i][j] = 0; // 0è¡¨ç¤ºç©ºä½
                }
            }
            currentPlayer = 1; // ç©å®¶å…ˆæ‰‹ï¼ˆé»‘æ£‹ï¼‰
            gameOver = false;
            winner = 0;
        }

        function draw() {
            background(220, 179, 92); // æ£‹ç›˜èƒŒæ™¯è‰²ï¼ˆæœ¨çº¹è‰²ï¼‰
            drawBoard();
            drawPieces();
            
            if (gameOver) {
                displayWinner();
            }
            
            // ç»˜åˆ¶è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼Œéƒ¨ç½²æ—¶å¯åˆ é™¤ï¼‰
            drawDebugInfo();
        }

        function drawDebugInfo() {
            fill(0);
            noStroke();
            textSize(12);
            textAlign(LEFT, TOP);
            text(`å½“å‰ç©å®¶: ${currentPlayer === 1 ? 'é»‘æ£‹(ç©å®¶)' : 'ç™½æ£‹(AI)'}`, 10, 10);
            if (winner) {
                text(`è·èƒœè€…: ${winner === 1 ? 'é»‘æ£‹(ç©å®¶)' : 'ç™½æ£‹(AI)'}`, 10, 30);
            }
        }

        function drawBoard() {
            stroke(0);
            strokeWeight(1);
            
            // ç»˜åˆ¶æ¨ªçº¿
            for (let i = 0; i < boardSize; i++) {
                line(margin, margin + i * cellSize, width - margin, margin + i * cellSize);
            }
            
            // ç»˜åˆ¶ç«–çº¿
            for (let j = 0; j < boardSize; j++) {
                line(margin + j * cellSize, margin, margin + j * cellSize, height - margin);
            }
            
            // ç»˜åˆ¶å¤©å…ƒå’Œæ˜Ÿä½
            fill(0);
            noStroke();
            let starPoints = [
                {x: 3, y: 3}, {x: 3, y: 11}, {x: 11, y: 3}, {x: 11, y: 11}, // å››è§’æ˜Ÿä½
                {x: 7, y: 7} // å¤©å…ƒ
            ];
            
            for (let point of starPoints) {
                circle(margin + point.x * cellSize, margin + point.y * cellSize, 8);
            }
        }

        function drawPieces() {
            for (let i = 0; i < boardSize; i++) {
                for (let j = 0; j < boardSize; j++) {
                    if (board[i][j] === 1) {
                        // é»‘æ£‹ - ç¡®ä¿é¢œè‰²æ­£ç¡®
                        fill(0); // çº¯é»‘è‰²
                        stroke(0); // é»‘è‰²è¾¹æ¡†
                        strokeWeight(2);
                        circle(margin + j * cellSize, margin + i * cellSize, cellSize * 0.8);
                    } else if (board[i][j] === 2) {
                        // ç™½æ£‹ - ç¡®ä¿é¢œè‰²æ­£ç¡®
                        fill(255); // çº¯ç™½è‰²
                        stroke(0); // é»‘è‰²è¾¹æ¡†
                        strokeWeight(2);
                        circle(margin + j * cellSize, margin + i * cellSize, cellSize * 0.8);
                    }
                }
            }
        }

        function mousePressed() {
            if (gameOver) {
                // é‡æ–°å¼€å§‹æ¸¸æˆ
                console.log("æ¸¸æˆç»“æŸï¼Œé‡æ–°å¼€å§‹");
                initializeBoard();
                return;
            }
            
            // åªæœ‰å½“å‰æ˜¯ç©å®¶å›åˆæ—¶æ‰èƒ½è½å­
            if (currentPlayer !== 1) {
                console.log("ä¸æ˜¯ç©å®¶å›åˆï¼Œå½“å‰ç©å®¶:", currentPlayer);
                return;
            }
            
            // è®¡ç®—é¼ æ ‡ç‚¹å‡»ä½ç½®å¯¹åº”çš„æ£‹ç›˜åæ ‡
            let col = Math.round((mouseX - margin) / cellSize);
            let row = Math.round((mouseY - margin) / cellSize);
            
            // æ£€æŸ¥æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
            if (row >= 0 && row < boardSize && col >= 0 && col < boardSize) {
                // æ£€æŸ¥è¯¥ä½ç½®æ˜¯å¦ä¸ºç©º
                if (board[row][col] === 0) {
                    console.log(`ç©å®¶åœ¨ä½ç½® (${row}, ${col}) è½å­`);
                    
                    // ç©å®¶è½å­ï¼ˆé»‘æ£‹ï¼‰- æ˜ç¡®è®¾ç½®ä¸º1
                    board[row][col] = 1;
                    
                    // å¼ºåˆ¶ç«‹å³é‡ç»˜
                    redraw();
                    
                    // æ£€æŸ¥æ˜¯å¦è·èƒœ
                    if (checkWin(row, col)) {
                        console.log("ç©å®¶è·èƒœï¼");
                        gameOver = true;
                        winner = 1;
                    } else {
                        // åˆ‡æ¢åˆ°AIç©å®¶ - æ˜ç¡®è®¾ç½®ä¸º2
                        currentPlayer = 2;
                        console.log("åˆ‡æ¢åˆ°AIå›åˆ");
                        
                        // å»¶è¿ŸAIè½å­ï¼Œè®©ç©å®¶çœ‹åˆ°è‡ªå·±çš„è½å­æ•ˆæœ
                        setTimeout(() => {
                            if (!gameOver) {
                                aiMove();
                            }
                        }, 500);
                    }
                } else {
                    console.log("è¯¥ä½ç½®å·²æœ‰æ£‹å­");
                }
            }
        }

        function aiMove() {
            console.log("AIå¼€å§‹æ€è€ƒ...");
            if (gameOver) return;
            
            // å¯»æ‰¾æœ€ä½³è½å­ä½ç½®
            let bestMove = findBestMove();
            
            if (bestMove) {
                console.log(`AIåœ¨ä½ç½® (${bestMove.row}, ${bestMove.col}) è½å­`);
                // AIè½å­ - æ˜ç¡®è®¾ç½®ä¸º2
                board[bestMove.row][bestMove.col] = 2;
                
                // æ£€æŸ¥AIæ˜¯å¦è·èƒœ
                if (checkWin(bestMove.row, bestMove.col)) {
                    console.log("AIè·èƒœï¼");
                    gameOver = true;
                    winner = 2;
                } else {
                    // åˆ‡æ¢å›ç©å®¶
                    currentPlayer = 1;
                    console.log("åˆ‡æ¢å›ç©å®¶å›åˆ");
                }
            }
        }

        function findBestMove() {
            // è¯„ä¼°æ£‹ç›˜ä¸Šæ‰€æœ‰ç©ºä½çš„å¾—åˆ†ï¼Œé€‰æ‹©å¾—åˆ†æœ€é«˜çš„ä½ç½®
            let bestScore = -Infinity;
            let bestMove = null;
            
            // å¦‚æœæ£‹ç›˜ä¸Šåªæœ‰ä¸€é¢—å­ï¼Œè¿™æ˜¯AIçš„ç¬¬ä¸€æ­¥
            let emptyCount = 0;
            for (let i = 0; i < boardSize; i++) {
                for (let j = 0; j < boardSize; j++) {
                    if (board[i][j] === 0) emptyCount++;
                }
            }
            
            // Bugä¿®å¤ï¼šå¢åŠ äº†å¯¹ä¸­å¿ƒç‚¹æ˜¯å¦è¢«å ç”¨çš„åˆ¤æ–­
            if (emptyCount === boardSize * boardSize - 1) {
                if (board[7][7] === 0) {
                    return {row: 7, col: 7}; // AIç¬¬ä¸€æ­¥ä¸‹åœ¨å¤©å…ƒä½ç½®
                } else {
                    return {row: 7, col: 8}; // å¦‚æœä¸­å¿ƒè¢«å ï¼Œä¸‹åœ¨æ—è¾¹
                }
            }
            
            // è¯„ä¼°æ¯ä¸ªç©ºä½
            for (let i = 0; i < boardSize; i++) {
                for (let j = 0; j < boardSize; j++) {
                    if (board[i][j] === 0) {
                        let score = evaluatePosition(i, j);
                        
                        // ä¼˜å…ˆé€‰æ‹©èƒ½ç›´æ¥è·èƒœçš„ä½ç½®
                        board[i][j] = 2; // ä¸´æ—¶è®¾ç½®ä¸ºAIæ£‹å­
                        if (checkWin(i, j)) {
                            board[i][j] = 0;
                            return {row: i, col: j};
                        }
                        board[i][j] = 0;
                        
                        // æ£€æŸ¥æ˜¯å¦éœ€è¦é˜²å®ˆï¼ˆé˜»æ­¢ç©å®¶è·èƒœï¼‰
                        board[i][j] = 1; // ä¸´æ—¶è®¾ç½®ä¸ºç©å®¶æ£‹å­
                        if (checkWin(i, j)) {
                            board[i][j] = 0;
                            return {row: i, col: j}; // é˜»æ­¢ç©å®¶è·èƒœ
                        }
                        board[i][j] = 0;
                        
                        // é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ä½ç½®
                        if (score > bestScore) {
                            bestScore = score;
                            bestMove = {row: i, col: j};
                        }
                    }
                }
            }
            
            return bestMove;
        }

        function evaluatePosition(row, col) {
            let score = 0;
            
            // è¯„ä¼°åœ¨(row, col)ä½ç½®è½å­çš„ä»·å€¼
            // æ£€æŸ¥å››ä¸ªæ–¹å‘ï¼šæ¨ªå‘ã€çºµå‘ã€å·¦æ–œã€å³æ–œ
            const directions = [
                [0, 1],   // æ¨ªå‘
                [1, 0],   // çºµå‘
                [1, 1],   // å³æ–œï¼ˆä»å·¦ä¸Šåˆ°å³ä¸‹ï¼‰
                [1, -1]   // å·¦æ–œï¼ˆä»å³ä¸Šåˆ°å·¦ä¸‹ï¼‰
            ];
            
            // è¯„ä¼°AIè½å­åçš„ä»·å€¼
            for (let dir of directions) {
                score += evaluateDirection(row, col, dir, 2); // AIæ˜¯2
            }
            
            // è¯„ä¼°ç©å®¶è½å­åçš„ä»·å€¼ï¼ˆé˜²å®ˆï¼‰
            for (let dir of directions) {
                score += evaluateDirection(row, col, dir, 1) * 0.8; // é˜²å®ˆä»·å€¼ç¨ä½
            }
            
            // ä¸­å¿ƒä½ç½®åŠ åˆ†
            let centerRow = Math.floor(boardSize / 2);
            let centerCol = Math.floor(boardSize / 2);
            let distanceToCenter = Math.abs(row - centerRow) + Math.abs(col - centerCol);
            score += (boardSize - distanceToCenter) * 2; // è·ç¦»ä¸­å¿ƒè¶Šè¿‘ï¼ŒåŠ åˆ†è¶Šå¤š
            
            return score;
        }

        function evaluateDirection(row, col, direction, player) {
            let score = 0;
            
            // è®¡ç®—åœ¨æŒ‡å®šæ–¹å‘ä¸Šè¿ç»­çš„æ£‹å­æ•°é‡
            let count = 1; // åŒ…å«å½“å‰ä½ç½®
            let openEnds = 0; // å¼€æ”¾ç«¯æ•°é‡
            
            // å‘æ­£æ–¹å‘æ£€æŸ¥
            let r = row + direction[0];
            let c = col + direction[1];
            let blocked = false;
            
            while (r >= 0 && r < boardSize && c >= 0 && c < boardSize) {
                if (board[r][c] === player) {
                    count++;
                } else if (board[r][c] === 0) {
                    openEnds++;
                    break;
                } else {
                    blocked = true;
                    break;
                }
                r += direction[0];
                c += direction[1];
            }
            
            if (!blocked && (r < 0 || r >= boardSize || c < 0 || c >= boardSize)) {
                openEnds++;
            }
            
            // å‘åæ–¹å‘æ£€æŸ¥
            r = row - direction[0];
            c = col - direction[1];
            blocked = false;
            
            while (r >= 0 && r < boardSize && c >= 0 && c < boardSize) {
                if (board[r][c] === player) {
                    count++;
                } else if (board[r][c] === 0) {
                    openEnds++;
                    break;
                } else {
                    blocked = true;
                    break;
                }
                r -= direction[0];
                c -= direction[1];
            }
            
            if (!blocked && (r < 0 || r >= boardSize || c < 0 || c >= boardSize)) {
                openEnds++;
            }
            
            // æ ¹æ®è¿ç»­æ£‹å­æ•°é‡å’Œå¼€æ”¾ç«¯æ•°é‡è¯„åˆ†
            if (count >= 5) {
                score += 100000; // è·èƒœ
            } else if (count === 4) {
                if (openEnds >= 2) {
                    score += 50000; // æ´»å››
                } else if (openEnds === 1) {
                    score += 10000; // å†²å››
                }
            } else if (count === 3) {
                if (openEnds >= 2) {
                    score += 5000; // æ´»ä¸‰
                } else if (openEnds === 1) {
                    score += 1000; // çœ ä¸‰
                }
            } else if (count === 2) {
                if (openEnds >= 2) {
                    score += 500; // æ´»äºŒ
                } else if (openEnds === 1) {
                    score += 100; // çœ äºŒ
                }
            } else if (count === 1) {
                if (openEnds >= 2) {
                    score += 50; // æ´»ä¸€
                }
            }
            
            return score;
        }

        function checkWin(row, col) {
            // æ£€æŸ¥å››ä¸ªæ–¹å‘ï¼šæ¨ªå‘ã€çºµå‘ã€å·¦æ–œã€å³æ–œ
            const directions = [
                [0, 1],   // æ¨ªå‘
                [1, 0],   // çºµå‘
                [1, 1],   // å³æ–œï¼ˆä»å·¦ä¸Šåˆ°å³ä¸‹ï¼‰
                [1, -1]   // å·¦æ–œï¼ˆä»å³ä¸Šåˆ°å·¦ä¸‹ï¼‰
            ];
            
            for (let dir of directions) {
                let count = 1; // åŒ…å«å½“å‰è½å­ä½ç½®
                
                // å‘æ­£æ–¹å‘æ£€æŸ¥
                let r = row + dir[0];
                let c = col + dir[1];
                while (r >= 0 && r < boardSize && c >= 0 && c < boardSize && board[r][c] === board[row][col]) {
                    count++;
                    r += dir[0];
                    c += dir[1];
                }
                
                // å‘åæ–¹å‘æ£€æŸ¥
                r = row - dir[0];
                c = col - dir[1];
                while (r >= 0 && r < boardSize && c >= 0 && c < boardSize && board[r][c] === board[row][col]) {
                    count++;
                    r -= dir[0];
                    c -= dir[1];
                }
                
                // å¦‚æœè¿ç»­5ä¸ªæˆ–ä»¥ä¸Šï¼Œè·èƒœ
                if (count >= 5) {
                    return true;
                }
            }
            
            return false;
        }

        function displayWinner() {
            textSize(32);
            textAlign(CENTER, CENTER);
            fill(255, 0, 0);
            if (winner === 1) {
                text("æ­å–œä½ è·èƒœï¼", width / 2, height / 2);
            } else if (winner === 2) {
                text("AIè·èƒœï¼", width / 2, height / 2);
            }
            
            // æç¤ºé‡æ–°å¼€å§‹
            textSize(16);
            text("ç‚¹å‡»é¼ æ ‡é‡æ–°å¼€å§‹", width / 2, height / 2 + 40);
        }
    </script>
</body>
</html>