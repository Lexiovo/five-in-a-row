<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½äº”å­æ£‹å¯¹æˆ˜ (ç§»åŠ¨ç«¯é€‚é…)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }
        
        .game-title {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .game-rules {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            text-align: center;
            max-width: 600px;
        }
        
        .game-canvas {
            margin: 0 auto;
            display: block;
        }
        
        .footer {
            font-size: 12px;
            color: #999;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-title">ğŸ® æ™ºèƒ½äº”å­æ£‹å¯¹æˆ˜</div>
        <div class="game-rules">
            é»‘æ£‹å…ˆè¡Œï¼Œç‚¹å‡»æ£‹ç›˜è½å­ã€‚AIä¼šè‡ªåŠ¨å›åº”ã€‚äº”å­è¿ç è·èƒœï¼<br>
            æ¸¸æˆç»“æŸåç‚¹å‡»æˆ–è§¦æ‘¸å±å¹•é‡æ–°å¼€å§‹ã€‚
        </div>
        <div id="canvas-container">
            <!-- p5.js will create the canvas here -->
        </div>
    </div>
    <div class="footer">
        Â© 2025 æ™ºèƒ½äº”å­æ£‹æ¸¸æˆ | ç‚¹å‡»æ£‹ç›˜å¼€å§‹å¯¹æˆ˜
    </div>

    <script>
        let board = [];
        let currentPlayer = 1;
        let gameOver = false;
        let winner = 0;
        let boardSize = 15;
        let cellSize;
        let margin;
        let aiPlayer = 2;
        let canvas;

        function setup() {
            canvas = createCanvas(600, 600);
            canvas.parent('canvas-container');
            canvas.addClass('game-canvas');
            
            cellSize = width / (boardSize + 1);
            margin = cellSize;
            
            initializeBoard();
        }

        function initializeBoard() {
            board = [];
            for (let i = 0; i < boardSize; i++) {
                board[i] = [];
                for (let j = 0; j < boardSize; j++) {
                    board[i][j] = 0;
                }
            }
            currentPlayer = 1;
            gameOver = false;
            winner = 0;
        }

        function draw() {
            background(220, 179, 92);
            drawBoard();
            drawPieces();
            
            if (gameOver) {
                displayWinner();
            }
            
            drawDebugInfo();
        }

        function drawDebugInfo() {
            fill(0);
            noStroke();
            textSize(12);
            textAlign(LEFT, TOP);
            text(`å½“å‰ç©å®¶: ${currentPlayer === 1 ? 'é»‘æ£‹(ç©å®¶)' : 'ç™½æ£‹(AI)'}`, 10, 10);
            if (winner) {
                text(`è·èƒœè€…: ${winner === 1 ? 'é»‘æ£‹(ç©å®¶)' : 'ç™½æ£‹(AI)'}`, 10, 30);
            }
        }

        function drawBoard() {
            stroke(0);
            strokeWeight(1);
            
            for (let i = 0; i < boardSize; i++) {
                line(margin, margin + i * cellSize, width - margin, margin + i * cellSize);
            }
            
            for (let j = 0; j < boardSize; j++) {
                line(margin + j * cellSize, margin, margin + j * cellSize, height - margin);
            }
            
            fill(0);
            noStroke();
            let starPoints = [
                {x: 3, y: 3}, {x: 3, y: 11}, {x: 11, y: 3}, {x: 11, y: 11},
                {x: 7, y: 7}
            ];
            
            for (let point of starPoints) {
                circle(margin + point.x * cellSize, margin + point.y * cellSize, 8);
            }
        }

        function drawPieces() {
            for (let i = 0; i < boardSize; i++) {
                for (let j = 0; j < boardSize; j++) {
                    if (board[i][j] === 1) {
                        fill(0);
                        stroke(0);
                        strokeWeight(2);
                        circle(margin + j * cellSize, margin + i * cellSize, cellSize * 0.8);
                    } else if (board[i][j] === 2) {
                        fill(255);
                        stroke(0);
                        strokeWeight(2);
                        circle(margin + j * cellSize, margin + i * cellSize, cellSize * 0.8);
                    }
                }
            }
        }

        // ç»Ÿä¸€çš„è¾“å…¥å¤„ç†å‡½æ•°
        function handlePlayerTurn(inputX, inputY) {
            if (gameOver) {
                console.log("æ¸¸æˆç»“æŸï¼Œé‡æ–°å¼€å§‹");
                initializeBoard();
                return;
            }
            
            if (currentPlayer !== 1) {
                console.log("ä¸æ˜¯ç©å®¶å›åˆï¼Œå½“å‰ç©å®¶:", currentPlayer);
                return;
            }
            
            let col = Math.round((inputX - margin) / cellSize);
            let row = Math.round((inputY - margin) / cellSize);
            
            if (row >= 0 && row < boardSize && col >= 0 && col < boardSize) {
                if (board[row][col] === 0) {
                    console.log(`ç©å®¶åœ¨ä½ç½® (${row}, ${col}) è½å­`);
                    board[row][col] = 1;
                    redraw();
                    
                    if (checkWin(row, col)) {
                        console.log("ç©å®¶è·èƒœï¼");
                        gameOver = true;
                        winner = 1;
                    } else {
                        currentPlayer = 2;
                        console.log("åˆ‡æ¢åˆ°AIå›åˆ");
                        setTimeout(() => {
                            if (!gameOver) {
                                aiMove();
                            }
                        }, 500);
                    }
                } else {
                    console.log("è¯¥ä½ç½®å·²æœ‰æ£‹å­");
                }
            }
        }
        
        // å“åº”é¼ æ ‡ç‚¹å‡»
        function mousePressed() {
            handlePlayerTurn(mouseX, mouseY);
        }

        // å“åº”æ‰‹æœºè§¦æ‘¸
        function touchStarted() {
            handlePlayerTurn(mouseX, mouseY);
            // é˜²æ­¢æµè§ˆå™¨é»˜è®¤çš„è§¦æ‘¸è¡Œä¸ºï¼ˆå¦‚æ»šåŠ¨é¡µé¢ï¼‰
            return false;
        }

        function aiMove() {
            console.log("AIå¼€å§‹æ€è€ƒ...");
            if (gameOver) return;
            
            let bestMove = findBestMove();
            
            if (bestMove) {
                console.log(`AIåœ¨ä½ç½® (${bestMove.row}, ${bestMove.col}) è½å­`);
                board[bestMove.row][bestMove.col] = 2;
                
                if (checkWin(bestMove.row, bestMove.col)) {
                    console.log("AIè·èƒœï¼");
                    gameOver = true;
                    winner = 2;
                } else {
                    currentPlayer = 1;
                    console.log("åˆ‡æ¢å›ç©å®¶å›åˆ");
                }
            }
        }

        function findBestMove() {
            let bestScore = -Infinity;
            let bestMove = null;
            
            let emptyCount = 0;
            for (let i = 0; i < boardSize; i++) {
                for (let j = 0; j < boardSize; j++) {
                    if (board[i][j] === 0) emptyCount++;
                }
            }
            
            if (emptyCount === boardSize * boardSize - 1) {
                if (board[7][7] === 0) {
                    return {row: 7, col: 7};
                } else {
                    return {row: 7, col: 8};
                }
            }
            
            for (let i = 0; i < boardSize; i++) {
                for (let j = 0; j < boardSize; j++) {
                    if (board[i][j] === 0) {
                        let score = evaluatePosition(i, j);
                        
                        board[i][j] = 2;
                        if (checkWin(i, j)) {
                            board[i][j] = 0;
                            return {row: i, col: j};
                        }
                        board[i][j] = 0;
                        
                        board[i][j] = 1;
                        if (checkWin(i, j)) {
                            board[i][j] = 0;
                            return {row: i, col: j};
                        }
                        board[i][j] = 0;
                        
                        if (score > bestScore) {
                            bestScore = score;
                            bestMove = {row: i, col: j};
                        }
                    }
                }
            }
            
            return bestMove;
        }

        function evaluatePosition(row, col) {
            let score = 0;
            const directions = [[0, 1], [1, 0], [1, 1], [1, -1]];
            
            for (let dir of directions) {
                score += evaluateDirection(row, col, dir, 2);
            }
            
            for (let dir of directions) {
                score += evaluateDirection(row, col, dir, 1) * 0.8;
            }
            
            let centerRow = Math.floor(boardSize / 2);
            let centerCol = Math.floor(boardSize / 2);
            let distanceToCenter = Math.abs(row - centerRow) + Math.abs(col - centerCol);
            score += (boardSize - distanceToCenter) * 2;
            
            return score;
        }

        function evaluateDirection(row, col, direction, player) {
            let score = 0;
            let count = 1;
            let openEnds = 0;
            
            let r = row + direction[0];
            let c = col + direction[1];
            let blocked = false;
            
            while (r >= 0 && r < boardSize && c >= 0 && c < boardSize) {
                if (board[r][c] === player) {
                    count++;
                } else if (board[r][c] === 0) {
                    openEnds++;
                    break;
                } else {
                    blocked = true;
                    break;
                }
                r += direction[0];
                c += direction[1];
            }
            
            if (!blocked && (r < 0 || r >= boardSize || c < 0 || c >= boardSize)) {
                openEnds++;
            }
            
            r = row - direction[0];
            c = col - direction[1];
            blocked = false;
            
            while (r >= 0 && r < boardSize && c >= 0 && c < boardSize) {
                if (board[r][c] === player) {
                    count++;
                } else if (board[r][c] === 0) {
                    openEnds++;
                    break;
                } else {
                    blocked = true;
                    break;
                }
                r -= direction[0];
                c -= direction[1];
            }
            
            if (!blocked && (r < 0 || r >= boardSize || c < 0 || c >= boardSize)) {
                openEnds++;
            }
            
            if (count >= 5) score += 100000;
            else if (count === 4) {
                if (openEnds >= 2) score += 50000;
                else if (openEnds === 1) score += 10000;
            } else if (count === 3) {
                if (openEnds >= 2) score += 5000;
                else if (openEnds === 1) score += 1000;
            } else if (count === 2) {
                if (openEnds >= 2) score += 500;
                else if (openEnds === 1) score += 100;
            } else if (count === 1) {
                if (openEnds >= 2) score += 50;
            }
            
            return score;
        }

        function checkWin(row, col) {
            const directions = [[0, 1], [1, 0], [1, 1], [1, -1]];
            
            for (let dir of directions) {
                let count = 1;
                
                let r = row + dir[0];
                let c = col + dir[1];
                while (r >= 0 && r < boardSize && c >= 0 && c < boardSize && board[r][c] === board[row][col]) {
                    count++;
                    r += dir[0];
                    c += dir[1];
                }
                
                r = row - dir[0];
                c = col - dir[1];
                while (r >= 0 && r < boardSize && c >= 0 && c < boardSize && board[r][c] === board[row][col]) {
                    count++;
                    r -= dir[0];
                    c -= dir[1];
                }
                
                if (count >= 5) {
                    return true;
                }
            }
            
            return false;
        }

        function displayWinner() {
            textSize(32);
            textAlign(CENTER, CENTER);
            fill(255, 0, 0);
            if (winner === 1) {
                text("æ­å–œä½ è·èƒœï¼", width / 2, height / 2);
            } else if (winner === 2) {
                text("AIè·èƒœï¼", width / 2, height / 2);
            }
            
            textSize(16);
            text("ç‚¹å‡»æˆ–è§¦æ‘¸å±å¹•é‡æ–°å¼€å§‹", width / 2, height / 2 + 40);
        }
    </script>
</body>
</html>